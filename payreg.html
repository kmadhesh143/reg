<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Event Registration</title>
  <style>
    body {
      font-family: "Poppins", sans-serif;
      background: linear-gradient(135deg, #74ebd5, #9face6);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 20px;
    }

    .form-container {
      background: rgba(255, 255, 255, 0.9);
      padding: 30px 40px;
      border-radius: 16px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
      width: 420px;
      text-align: center;
      backdrop-filter: blur(8px);
    }

    h2 {
      margin-bottom: 20px;
      color: #2c3e50;
      font-weight: 700;
    }

    label {
      display: block;
      text-align: left;
      margin-top: 12px;
      font-weight: 500;
      color: #34495e;
    }

    input[type="text"], input[type="email"], input[type="file"] {
      width: 100%;
      padding: 10px;
      margin-top: 6px;
      border: 1px solid #ccc;
      border-radius: 10px;
      outline: none;
      transition: border 0.3s;
    }

    input:focus {
      border-color: #2980b9;
    }

    button, .pay-btn {
      background: #3498db;
      border: none;
      color: white;
      padding: 12px;
      border-radius: 10px;
      margin-top: 18px;
      width: 100%;
      font-size: 16px;
      cursor: pointer;
      font-weight: 600;
      transition: 0.3s ease;
      text-decoration: none;
      display: inline-block;
    }

    button:hover, .pay-btn:hover {
      background: #2d81bd;
    }

    .payment-box {
      margin-top: 20px;
      display: none;
      animation: fadeIn 0.4s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    #qrcode {
      margin: 20px auto;
      display: flex;
      justify-content: center;
    }

    /* Overlay Loader */
    .overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.4);
      backdrop-filter: blur(5px);
      display: flex;
      align-items: center;
      justify-content: center;
      display: none;
      z-index: 1000;
    }

    .loader-box {
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    /* Circle progress */
    .progress-circle {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      border: 10px solid rgba(255,255,255,0.4);
      border-top-color: #3498db;
      animation: spin 1s linear infinite;
    }

    @keyframes spin { 
      100% { transform: rotate(360deg); } 
    }

    /* Success tick */
    .success-check {
      display: none;
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: rgb(99, 255, 107);
      display: flex;
      align-items: center;
      justify-content: center;
      animation: pop 0.3s ease-out forwards;
    }

    .success-check svg {
      width: 60px;
      height: 60px;
      stroke: #ffffff;
      stroke-width: 6;
      fill: none;
      stroke-linecap: round;
      stroke-linejoin: round;
    }

    @keyframes pop {
      from { transform: scale(0.5); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
  </style>
</head>
<body>
  <div class="form-container">
    <h2>Registration Form</h2>
    <form id="regForm">
      <label>Name:</label><input type="text" name="name" required>
      <label>College:</label><input type="text" name="college" required>
      <label>Year:</label>
      <label><input type="radio" name="year" value="I" required> I</label>
      <label><input type="radio" name="year" value="II"> II</label>
      <label><input type="radio" name="year" value="III"> III</label>
      <label><input type="radio" name="year" value="IV"> IV</label>
      <label>Department:</label><input type="text" name="department" required>
            <label>Events (Select Max 2):</label>
<label><input type="checkbox" name="event" value="Paper Presentation" class="eventChk"> Paper Presentation</label>
<label><input type="checkbox" name="event" value="Hunt Quest" class="eventChk"> Hunt Quest</label>
<label><input type="checkbox" name="event" value="Prompt Protocol" class="eventChk"> Prompt Protocol</label>
<label><input type="checkbox" name="event" value="Cyber Pixels" class="eventChk"> Cyber Pixels</label>
<label><input type="checkbox" name="event" value="Case 404" class="eventChk"> Case 404</label>
<label><input type="checkbox" name="event" value="Code in Borderland" class="eventChk"> Code in Borderland</label>

      <label>Email:</label><input type="email" name="email" required>
      <label>Phone:</label><input type="text" name="phone" required>

      <button type="button" id="proceedBtn">Proceed to Payment</button>

      <!-- Payment Section -->
      <div class="payment-box" id="paymentBox">
        <h3>Pay ₹150 to Complete Registration</h3>
        <div id="qrcode"></div>
        <p>Scan the QR code or click the button below to pay via UPI:</p>
        <a id="payBtn" class="pay-btn" target="_blank">Pay ₹150</a>
        <label>Upload Payment Screenshot:</label>
        <input type="file" id="screenshot" name="screenshot" accept="image/*" required>
        <button type="submit">Submit Registration</button>
      </div>
    </form>
  </div>

  <!-- Overlay loader -->
  <div class="overlay" id="overlay">
    <div class="loader-box">
      <div class="progress-circle" id="progress"></div>
      <div class="success-check" id="success">
        <svg viewBox="0 0 52 52">
          <path d="M14 27l7 7 17-17"></path>
        </svg>
      </div>
    </div>
  </div>

  <!-- QRCode.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

  <script>
    const checkboxes = document.querySelectorAll('.eventChk');
  checkboxes.forEach(cb => {
    cb.addEventListener('change', () => {
      let checked = document.querySelectorAll('.eventChk:checked');
      if (checked.length > 2) {
        cb.checked = false;
        alert("You can select maximum 2 events only!");
      }
    });
  });
  const form = document.getElementById("regForm");
  const paymentBox = document.getElementById("paymentBox");
  const payBtn = document.getElementById("payBtn");
  const proceedBtn = document.getElementById("proceedBtn");

  const overlay = document.getElementById("overlay");
  const progress = document.getElementById("progress");
  const success = document.getElementById("success");

  proceedBtn.addEventListener("click", () => {
    const upiId = "kmadhesh1017@okicici";
    const amount = 150;
    const name = "Madhesh";
    const upiUrl = `upi://pay?pa=${upiId}&pn=${encodeURIComponent(name)}&am=${amount}&cu=INR`;

    paymentBox.style.display = "block";
    proceedBtn.style.display = "none";

    document.getElementById("qrcode").innerHTML = "";
    new QRCode(document.getElementById("qrcode"), {
      text: upiUrl, width: 180, height: 180
    });
    payBtn.href = upiUrl;
  });

  form.addEventListener("submit", async function(e){
    e.preventDefault();
    const fileInput = document.getElementById("screenshot").files[0];
    if (!fileInput) {
      alert("Please upload payment screenshot before submitting!");
      return;
    }

    const formData = new FormData(form);
    const base64 = await toBase64(fileInput);
    formData.append("filename", fileInput.name);
    formData.append("mimetype", fileInput.type);
    formData.append("screenshot", base64.split(",")[1]);

    overlay.style.display = "flex";
    progress.style.display = "block";
    success.style.display = "none";

    fetch("https://script.google.com/macros/s/AKfycbxGxouZV3D34-8c0_OaS1szdI_sC0LOO2gAQqohtB8EYIwpoM4S68d95qQnkxDPN9Assw/exec", {
      method: "POST",
      body: formData
    })
    .then(res => res.text())
    .then(data => {
      progress.style.display = "none";
      success.style.display = "flex";
      setTimeout(() => {
        overlay.style.display = "none";
        alert("Registration Successful ✅ Check your mail for confirmation.");
        form.reset();
        paymentBox.style.display = "none";
        proceedBtn.style.display = "block";
      }, 1500);
    })
    .catch(err => {
      overlay.style.display = "none";
      alert("Upload failed: " + err);
    });
  });

  function toBase64(file) {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.readAsDataURL(file);
      reader.onload = () => resolve(reader.result);
      reader.onerror = error => reject(error);
    });
  }
  </script>
</body>
</html>
